{
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56903",
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56903/labels{/name}",
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56903/comments",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56903/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/56903",
  "id": 279926443,
  "node_id": "MDU6SXNzdWUyNzk5MjY0NDM=",
  "number": 56903,
  "title": "DNS intermittent delays of 5s",
  "user": {
    "login": "mikksoone",
    "id": 1069008,
    "node_id": "MDQ6VXNlcjEwNjkwMDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1069008?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mikksoone",
    "html_url": "https://github.com/mikksoone",
    "followers_url": "https://api.github.com/users/mikksoone/followers",
    "following_url": "https://api.github.com/users/mikksoone/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikksoone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mikksoone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikksoone/subscriptions",
    "organizations_url": "https://api.github.com/users/mikksoone/orgs",
    "repos_url": "https://api.github.com/users/mikksoone/repos",
    "events_url": "https://api.github.com/users/mikksoone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mikksoone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 390273825,
      "node_id": "MDU6TGFiZWwzOTAyNzM4MjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/dns",
      "name": "area/dns",
      "color": "0052cc",
      "default": false,
      "description": null
    },
    {
      "id": 105146071,
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug",
      "name": "kind/bug",
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug."
    },
    {
      "id": 116712108,
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network",
      "name": "sig/network",
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 253,
  "created_at": "2017-12-06T22:14:47Z",
  "updated_at": "2021-01-03T01:17:32Z",
  "closed_at": "2019-02-22T05:57:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n\r\n**What happened**:\r\nDNS lookup is sometimes taking 5 seconds.\r\n\r\n**What you expected to happen**:\r\nNo delays in DNS.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n1. Create a cluster in AWS using kops with cni networking:\r\n```\r\nkops create cluster     --node-count 3     --zones eu-west-1a,eu-west-1b,eu-west-1c     --master-zones eu-west-1a,eu-west-1b,eu-west-1c     --dns-zone kube.example.com   --node-size t2.medium     --master-size t2.medium  --topology private --networking cni   --cloud-labels \"Env=Staging\"  ${NAME}\r\n```\r\n2. CNI plugin:\r\n```\r\nkubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\"\r\n```\r\n3. Run this script in any pod with that has curl:\r\n```\r\nvar=1\r\nwhile true ; do\r\n  res=$( { curl -o /dev/null -s -w %{time_namelookup}\\\\n  http://www.google.com; } 2>&1 )\r\n  var=$((var+1))\r\n  if [[ $res =~ ^[1-9] ]]; then\r\n    now=$(date +\"%T\")\r\n    echo \"$var slow: $res $now\"\r\n    break\r\n  fi\r\ndone\r\n```\r\n**Anything else we need to know?**:\r\n1. I am encountering this issue in both staging and production clusters, but for some reason staging cluster is having a lot more 5s delays.\r\n2. Delays happen both for external services (google.com) or internal, such as service.namespace.\r\n3. Happens on both 1.6 and 1.7 version of kubernetes, but did not encounter these issues in 1.5 (though the setup was a bit different - no CNI back then).\r\n4. Have not tested with 1.7 without CNI yet.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"8\", GitVersion:\"v1.8.2\", GitCommit:\"bdaeafa71f6c7c04636251031f93464384d54963\", GitTreeState:\"clean\", BuildDate:\"2017-10-24T19:48:57Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.10\", GitCommit:\"bebdeb749f1fa3da9e1312c4b08e439c404b3136\", GitTreeState:\"clean\", BuildDate:\"2017-11-03T16:31:49Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration:\r\n```\r\nAWS\r\n```\r\n- OS (e.g. from /etc/os-release):\r\n```\r\nPRETTY_NAME=\"Ubuntu 16.04.3 LTS\"\r\n```\r\n- Kernel (e.g. `uname -a`):\r\n```\r\nLinux ingress-nginx-3882489562-438sm 4.4.65-k8s #1 SMP Tue May 2 15:48:24 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n**Similar issues**\r\n1. https://github.com/kubernetes/dns/issues/96 - closed but seems to be exactly the same\r\n2. https://github.com/kubernetes/kubernetes/issues/45976 - has some comments matching this issue, but is taking the direction of fixing kube-dns up/down scaling problem, and is not about the intermittent failures.\r\n\r\n/sig network",
  "closed_by": {
    "login": "thockin",
    "id": 5595220,
    "node_id": "MDQ6VXNlcjU1OTUyMjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5595220?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thockin",
    "html_url": "https://github.com/thockin",
    "followers_url": "https://api.github.com/users/thockin/followers",
    "following_url": "https://api.github.com/users/thockin/following{/other_user}",
    "gists_url": "https://api.github.com/users/thockin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thockin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thockin/subscriptions",
    "organizations_url": "https://api.github.com/users/thockin/orgs",
    "repos_url": "https://api.github.com/users/thockin/repos",
    "events_url": "https://api.github.com/users/thockin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thockin/received_events",
    "type": "User",
    "site_admin": false
  },
  "performed_via_github_app": null
}
